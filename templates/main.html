<!-- Defines the document type and version of HTML -->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Character encoding declaration -->
    <meta charset="UTF-8">
    <!-- Title of the webpage, shown in the browser tab -->
    <title>Math Tutor</title>
    <!-- Ensures proper display and scaling on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Link to external CSS file for styling -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Main container holding all webpage content -->
    <div class="container">
        <!-- Page title -->
        <h1 class="page-title">Math Tutor</h1>

        <!-- Left Column (Sidebar with list of topics) -->
        <div class="sidebar">
            <h3>Select a Topic</h3>
            <ul id="topic-list">
                <li onclick="fetchData('real_numbers')">Real Numbers</li>
                <li onclick="fetchData('order_of_operations')">Order of Operations</li>
                <li onclick="fetchData('absolute_value')">Absolute Value</li>
                <li onclick="fetchData('exponents')">Exponents</li>
                <li onclick="fetchData('linear_equations')">Linear Equations</li>
                <li onclick="fetchData('graphing_lines')">Graphing Lines</li>
                <li onclick="fetchData('inequalities')">Inequalities</li>
                <li onclick="fetchData('scientific_notation')">Scientific Notation</li>
                <li onclick="fetchData('polynomials')">Polynomials</li>
                <li onclick="fetchData('factoring')">Factoring</li>
            </ul>
        </div>

        <!-- Middle Column (Definition Display Area) -->
        <div class="definition-container">
            <h3>Definition</h3>
            <p id="definition">Select a topic to see the definition.</p>
            <button id="play-audio" onclick="playDefinition()">üîä Play Audio</button>
            <button id="stop-audio" onclick="stopAudio()">‚èπ Stop Audio</button>
            <div class="audio-progress-container">
                <progress id="audio-progress" value="0" max="100"></progress>
                <span id="audio-percentage">0%</span>
            </div>
        </div>

        <!-- Right Column (Chat Box) -->
        <div class="chat-container">
            <h3>Chat with Tutor</h3>
            <div class="chat-box" id="chatBox">
                <div class="typing-indicator" id="typing" style="display: none;">Tutor is typing...</div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Ask your math question..." onkeydown="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- NoScript fallback -->
    <noscript>
        <p style="text-align:center; color:red;">JavaScript is required to use this application.</p>
    </noscript>

    <!-- Load JavaScript files -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

    <!-- Ensure MathJax re-renders after dynamic content updates -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Monitor changes to the chat box and reprocess MathJax when needed
            const chatBox = document.getElementById("chatBox");
            const observer = new MutationObserver(() => {
                MathJax.typesetPromise([chatBox]).catch((err) => console.error("MathJax error:", err));
            });

            observer.observe(chatBox, { childList: true });
        });
    </script>
</body>
</html>
